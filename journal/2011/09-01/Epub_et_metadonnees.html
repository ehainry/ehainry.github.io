<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>epub et métadonnées [velsheda]</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link href="../../css/plus.css" rel="stylesheet">
<link rel="stylesheet" href="../../css/pygments.css" type="text/css" media="screen, projection" />
<link rel="icon" type="image/png" href="/icon.png" />
<meta name="author" content="EH" />
</head>
<body>
<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu-c">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
<a class="navbar-brand" href="/journal/index.html">Velsheda</a>
</div>
<div class="collapse navbar-collapse" id="menu-c">
<ul class="nav navbar-nav">
<li><a href="/journal/archive.html">Archive</a></li>
<li><a href="/journal/categories.html">Categories</a></li>
<li><a href="/journal/about.html">Contact</a></li>
<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Links</a>
<ul class="dropdown-menu">
	<li><a href="https://bitbucket.org/manu">Bitbucket</a></li>
	<li><a href="http://www.goodreads.com/user/show/2385793">Goodreads</a></li>
	<li><a href="http://last.fm/">Last.fm</a></li>
	<li><a href="https://linuxfr.org/">DLFP</a></li>
</ul></li>
</ul>
</div>
</div>
</nav>
<div class="container-fluid">
<div class="row">
<div class="col-sm-10">
 <h2>epub et métadonnées</h2>
 <!--<span id="tag">fr, ebook, epub, and propriétés</span>-->
 <span id="tag">
   
   <a href="/journal/categories.html#fr">fr</a>,
   
   <a href="/journal/categories.html#ebook">ebook</a>,
   
   <a href="/journal/categories.html#epub">epub</a>,
   
   <a href="/journal/categories.html#propriétés">propriétés</a>,
   </span>
 <p>Comme je l&#8217;ai déjà dit <a href='/journal/2011/05-27/Ecrire_en_epub.html'>précédemment</a>, un fichier epub est en réalité une archive zip ayant une structure et un contenu bien défini. Tout d&#8217;abord, il contient un fichier nommé <code>mimetype</code> contenant le texte <code>application/epub+zip</code>, premier fichier dans l&#8217;archive, sauvegardé sans compression. Pourquoi ? Tout simplement pour que les octets 30 à 57 du fichier contiennent exactement le texte <code>mimetypeapplication/epub+zip</code>.</p>

<p>Les autres fichiers peuvent être compressés et n&#8217;ont pas à respecter d&#8217;ordre.</p>

<p>Deuxième fichier obligatoire : <code>META-INF/container.xml</code>. Ce fichier semble avoir pour unique intérêt de dire où se trouve et comment se nomme le fichier de squelette (opf). Il est donc inutile de parcourir tous les fichiers à la recherche d&#8217;un fichier opf et cela permet de ne pas se tromper quand il y en a plusieurs&#8230; Expérience vécue : après avoir trouvé un fichier .opf, je m&#8217;aperçois qu&#8217;il ne contient absolument pas ce qu&#8217;il devrait et je comprends ma douleur en voyant qu&#8217;il s&#8217;agit de <code>__MACOSX/OEBPS/._content.opf</code> c&#8217;est-à-dire un fichier caché créé par un mac et qui n&#8217;a rien à faire dans un livre que je viens d&#8217;acheter, n&#8217;est-ce pas Bragelonne&#8230;</p>

<p>Le fichier qui m&#8217;intéresse aujourd&#8217;hui : le fichier opf. Celui-ci contient d&#8217;une part les métadonnées (titre, auteur(s), date de publication, etc.), d&#8217;autre part les fichiers utiles de l&#8217;archive ainsi que l&#8217;ordre dans lequel on parcourra le texte.</p>

<p>Par exemple (extrait de http://jean-claude.dunyach.pagesperso-orange.fr/Articles/Article.epub, je laisse le lecteur trouver le nom de l&#8217;auteur et le titre de l&#8217;article tout seul) :</p>
<div class='highlight'><pre><code class='xml'><span class='cp'>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class='nt'>&lt;package</span> <span class='na'>xmlns=</span><span class='s'>&quot;http://www.idpf.org/2007/opf&quot;</span> <span class='na'>version=</span><span class='s'>&quot;2.0&quot;</span> <span class='na'>unique-identifier=</span><span class='s'>&quot;BookId&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;metadata</span> <span class='na'>xmlns:dc=</span><span class='s'>&quot;http://purl.org/dc/elements/1.1/&quot;</span> <span class='na'>xmlns:opf=</span><span class='s'>&quot;http://www.idpf.org/2007/opf&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;dc:title&gt;</span>Le livre va-t-il sombrer dans la mer numérique ?<span class='nt'>&lt;/dc:title&gt;</span>
<span class='nt'>&lt;dc:creator</span> <span class='na'>opf:file-as=</span><span class='s'>&quot;Dunyach, Jean-Claude&quot;</span> <span class='na'>opf:role=</span><span class='s'>&quot;aut&quot;</span><span class='nt'>&gt;</span>Jean-Claude Dunyach<span class='nt'>&lt;/dc:creator&gt;</span>
<span class='nt'>&lt;dc:subject&gt;</span>ebook<span class='nt'>&lt;/dc:subject&gt;</span>
<span class='nt'>&lt;dc:description&gt;</span>Une réflexion sur l&#39;avenir du livre numérique<span class='nt'>&lt;/dc:description&gt;</span>
<span class='nt'>&lt;dc:publisher&gt;</span>Moi-même<span class='nt'>&lt;/dc:publisher&gt;</span>
<span class='nt'>&lt;dc:date&gt;</span>2010-10-22<span class='nt'>&lt;/dc:date&gt;</span>
<span class='nt'>&lt;dc:identifier</span> <span class='na'>id=</span><span class='s'>&quot;BookId&quot;</span><span class='nt'>&gt;</span>V 1.01<span class='nt'>&lt;/dc:identifier&gt;</span>
<span class='nt'>&lt;dc:language&gt;</span>fr<span class='nt'>&lt;/dc:language&gt;</span>
<span class='nt'>&lt;dc:rights&gt;</span>Creative Commons 2.0<span class='nt'>&lt;/dc:rights&gt;</span>
<span class='nt'>&lt;meta</span> <span class='na'>name=</span><span class='s'>&quot;price&quot;</span> <span class='na'>content=</span><span class='s'>&quot;0&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;meta</span> <span class='na'>name=</span><span class='s'>&quot;cover&quot;</span> <span class='na'>content=</span><span class='s'>&quot;img1&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/metadata&gt;</span>
<span class='nt'>&lt;manifest&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;ncx&quot;</span> <span class='na'>href=</span><span class='s'>&quot;toc.ncx&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;application/x-dtbncx+xml&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;style&quot;</span> <span class='na'>href=</span><span class='s'>&quot;style.css&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;text/css&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;id001&quot;</span> <span class='na'>href=</span><span class='s'>&quot;001.html&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;application/xhtml+xml&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;id002&quot;</span> <span class='na'>href=</span><span class='s'>&quot;002.html&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;application/xhtml+xml&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;id003&quot;</span> <span class='na'>href=</span><span class='s'>&quot;003.html&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;application/xhtml+xml&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;img1&quot;</span> <span class='na'>href=</span><span class='s'>&quot;images/img1.jpg&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;image/jpeg&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;img2&quot;</span> <span class='na'>href=</span><span class='s'>&quot;images/img2.png&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;image/png&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;img3&quot;</span> <span class='na'>href=</span><span class='s'>&quot;images/img3.png&quot;</span> <span class='na'>media-type=</span><span class='s'>&quot;image/png&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/manifest&gt;</span>
<span class='nt'>&lt;spine</span> <span class='na'>toc=</span><span class='s'>&quot;ncx&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;itemref</span> <span class='na'>idref=</span><span class='s'>&quot;id001&quot;</span> <span class='na'>linear=</span><span class='s'>&quot;no&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;itemref</span> <span class='na'>idref=</span><span class='s'>&quot;id002&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;itemref</span> <span class='na'>idref=</span><span class='s'>&quot;id003&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/spine&gt;</span>
<span class='nt'>&lt;guide&gt;</span>
<span class='nt'>&lt;reference</span> <span class='na'>type=</span><span class='s'>&quot;cover&quot;</span> <span class='na'>title=</span><span class='s'>&quot;Cover image&quot;</span> <span class='na'>href=</span><span class='s'>&quot;001.html&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/guide&gt;</span>
<span class='nt'>&lt;/package&gt;</span>
</code></pre>
</div>
<p>On trouve donc bien les informations promises (des dc:machin) et on apprend qu&#8217;il y a 3 fichiers html à commencer par celui ayant l&#8217;identifiant <code>id001</code> qui se trouve être le fichier <code>001.html</code>.</p>

<p>Quatrième fichier important et malheureusement mal exploité par certains éditeurs, la table des matières : <code>toc.ncx</code>. Mais ce sera pour un prochain épisode.</p>

<p>Pour en revenir aux métadonnées, je me suis confectionné un petit programme <a href='https://bitbucket.org/manu/epubinfo'>epubinfo</a> pour les lire et modifier. Je l&#8217;utilise en particulier pour changer les dates de publications (je classe les livres en fonction de cette date), corriger les noms d&#8217;auteur (par exemple le nom de famille d&#8217;<em>Alexandre Dumas fils</em> n&#8217;est pas <em>fils</em>) et mettre la bonne langue (ce qui permet à mon <a href='http://bookeen.com/fr/cybook/?id=2'>reader</a> de faire la césure comme il faut) sans ouvrir un vrai éditeur d&#8217;epub lourd (sigil) ni le faire complètement à la main.</p>

<p>Ensuite, je compte utiliser ce programme pour classer mes livres de façon un peu plus intelligente qu&#8217;actuellement (un dossier par auteur dans lequel les fichiers sont classés par date de publication) en groupant plusieurs auteurs dans un même dossier tant que cela représente moins de 12 livres par exemple mais sans séparer les livres d&#8217;un même auteur en deux dossiers différents.</p>
<div class="date">Écrit le 01 September 2011 par <a href="https://plus.google.com/103784259248105086753?rel=author">Emmanuel</a></div>
</div>
<div class="col-sm-2">
  <a href="/journal/index.html">Index</a><br />
  Next: <a href="/journal/2011/09-19/Livre-sur-la-place.html">Livre sur la place</a><br />
  Prev: <a href="/journal/2011/06-23/Prix_unique.html">Prix du livre</a><br />
</div>
</div>
</div>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
</body>
</html>
